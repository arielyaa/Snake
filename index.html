<!DOCTYPE html>

<html lang="zh">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

  <title>貪吃蛇 Snake Game</title>

  <style>

    html, body {

      margin: 0;

      padding: 0;

      background: #111;

      color: #eee;

      font-family: sans-serif;

      text-align: center;

      overflow: hidden;

    }

    h1 {

      margin-top: 10px;

    }

    canvas {

      border: 3px solid #0f0;

      background: black;

      display: block;

      margin: 10px auto;

    }

    #score {

      font-size: 18px;

    }

  </style>

</head>

<body>

  <h1>🐍 貪吃蛇 Snake Game</h1>

  <canvas id="game" width="400" height="400"></canvas>

  <div id="score">分數: 0</div>


  <script>

    const canvas = document.getElementById('game');

    const ctx = canvas.getContext('2d');

    const gridSize = 20;

    const tileCount = canvas.width / gridSize;


    let snake = [{x: 10, y: 10}];

    let velocityX = 1;

    let velocityY = 0;

    let food = {x: 15, y: 15};

    let score = 0;

    let gameOver = false;


    function gameLoop() {

      if (gameOver) {

        alert("遊戲結束！你的分數是：" + score);

        document.location.reload();

        return;

      }


      update();

      draw();

    }


    function update() {

      let head = {

        x: (snake[0].x + velocityX + tileCount) % tileCount,

        y: (snake[0].y + velocityY + tileCount) % tileCount

      };


      for (let segment of snake) {

        if (segment.x === head.x && segment.y === head.y) {

          gameOver = true;

          return;

        }

      }


      snake.unshift(head);


      if (head.x === food.x && head.y === food.y) {

        score++;

        document.getElementById("score").textContent = "分數: " + score;

        placeFood();

      } else {

        snake.pop();

      }

    }


    function draw() {

      ctx.fillStyle = "black";

      ctx.fillRect(0, 0, canvas.width, canvas.height);


      ctx.fillStyle = "red";

      ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);


      ctx.fillStyle = "lime";

      for (let segment of snake) {

        ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);

      }

    }


    function placeFood() {

      let newFood;

      while (true) {

        newFood = {

          x: Math.floor(Math.random() * tileCount),

          y: Math.floor(Math.random() * tileCount)

        };

        let conflict = snake.some(segment => segment.x === newFood.x && segment.y === newFood.y);

        if (!conflict) break;

      }

      food = newFood;

    }


    window.addEventListener("keydown", (e) => {

      switch (e.key) {

        case "ArrowUp":

          if (velocityY !== 1) { velocityX = 0; velocityY = -1; }

          break;

        case "ArrowDown":

          if (velocityY !== -1) { velocityX = 0; velocityY = 1; }

          break;

        case "ArrowLeft":

          if (velocityX !== 1) { velocityX = -1; velocityY = 0; }

          break;

        case "ArrowRight":

          if (velocityX !== -1) { velocityX = 1; velocityY = 0; }

          break;

      }

    });


    // 手機觸控滑動支援

    let touchStartX = 0;

    let touchStartY = 0;


    window.addEventListener("touchstart", (e) => {

      touchStartX = e.touches[0].clientX;

      touchStartY = e.touches[0].clientY;

    });


    window.addEventListener("touchend", (e) => {

      const dx = e.changedTouches[0].clientX - touchStartX;

      const dy = e.changedTouches[0].clientY - touchStartY;


      if (Math.abs(dx) > Math.abs(dy)) {

        if (dx > 30 && velocityX !== -1) {

          velocityX = 1; velocityY = 0;

        } else if (dx < -30 && velocityX !== 1) {

          velocityX = -1; velocityY = 0;

        }

      } else {

        if (dy > 30 && velocityY !== -1) {

          velocityX = 0; velocityY = 1;

        } else if (dy < -30 && velocityY !== 1) {

          velocityX = 0; velocityY = -1;

        }

      }

    });


    setInterval(gameLoop, 100);

  </script>

</body>

</html>

